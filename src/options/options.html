<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>tabSidian - Settings</title>
    <link rel="stylesheet" href="options.css" />
    <script src="options.js" defer></script>
  </head>
  <body>
    <div class="container">
      <header class="page-header">
        <img src="icon128.png" alt="tabSidian" class="logo" />
        <h1>tabSidian - Settings</h1>
        <p class="platform-hint" data-platform-hint hidden></p>
      </header>

      <div class="status-banner" data-status-message aria-live="polite"></div>

      <section class="panel panel-general">
        <div class="panel-header">
          <h2>General</h2>
          <p>Auto-save is enabled. Fields marked with * are required for direct Obsidian exports.</p>
        </div>
        <div class="field-grid two-column">
          <label for="obsidianVault">Obsidian vault name*</label>
          <input
            type="text"
            id="obsidianVault"
            placeholder="My Obsidian Vault"
            autocomplete="off"
          />

          <label for="obsidianNotePath">Note path template*</label>
          <input
            type="text"
            id="obsidianNotePath"
            placeholder="tabSidian/tab-export-{timestamp}.md"
            autocomplete="off"
          />
          <p class="hint full-width">
            <strong>{timestamp}</strong> is replaced with the export timestamp. Paths must end with <strong>.md</strong> and are resolved inside your vault.
          </p>
        </div>
        <div class="panel-footer">
          <div class="about">
            <span class="version">Version 1.8.2</span>
            <span class="dot">•</span>
            <a href="https://x.com/cgranier" target="_blank" rel="noreferrer">Contact</a>
            <span class="dot">•</span>
            <a href="https://github.com/cgranier/tabSidian" target="_blank" rel="noreferrer">Source</a>
          </div>
          <div class="reset-buttons">
            <button id="resetGeneral" type="button">Reset General</button>
            <button id="resetProperties" type="button">Reset Properties</button>
            <button id="resetTemplates" type="button">Reset Templates</button>
            <button id="resetRestricted" type="button">Reset Restricted URLs</button>
            <button id="resetAll" type="button" class="danger">Reset All</button>
          </div>
        </div>
      </section>

      <section class="panel panel-properties">
        <div class="panel-header">
          <h2>Properties</h2>
          <p>Customize the YAML keys generated in the export frontmatter.</p>
        </div>
        <div class="frontmatter-grid">
          <label for="frontmatter-date">Export date</label>
          <input
            id="frontmatter-date"
            type="text"
            data-frontmatter-field="date"
            spellcheck="false"
            autocomplete="off"
            autocapitalize="off"
            aria-label="Frontmatter field name for export date"
          />
          <label for="frontmatter-time">Export time</label>
          <input
            id="frontmatter-time"
            type="text"
            data-frontmatter-field="time"
            spellcheck="false"
            autocomplete="off"
            autocapitalize="off"
            aria-label="Frontmatter field name for export time"
          />
          <label for="frontmatter-exportedAt">Exported at (ISO)</label>
          <input
            id="frontmatter-exportedAt"
            type="text"
            data-frontmatter-field="exportedAt"
            spellcheck="false"
            autocomplete="off"
            autocapitalize="off"
            aria-label="Frontmatter field name for exported at timestamp"
          />
          <label for="frontmatter-tabCount">Tab count</label>
          <input
            id="frontmatter-tabCount"
            type="text"
            data-frontmatter-field="tabCount"
            spellcheck="false"
            autocomplete="off"
            autocapitalize="off"
            aria-label="Frontmatter field name for tab count"
          />
          <label for="frontmatter-windowTitle">Window title</label>
          <input
            id="frontmatter-windowTitle"
            type="text"
            data-frontmatter-field="windowTitle"
            spellcheck="false"
            autocomplete="off"
            autocapitalize="off"
            aria-label="Frontmatter field name for window title"
          />
          <label for="frontmatter-windowIncognito">Window incognito</label>
          <input
            id="frontmatter-windowIncognito"
            type="text"
            data-frontmatter-field="windowIncognito"
            spellcheck="false"
            autocomplete="off"
            autocapitalize="off"
            aria-label="Frontmatter field name for window incognito state"
          />
        </div>
        <div class="template-feedback frontmatter-feedback" data-frontmatter-feedback aria-live="polite"></div>
      </section>

      <section class="panel panel-templates">
        <div class="panel-header">
          <h2>Templates</h2>
          <p>Use Mustache-style placeholders to design the Markdown output. Rendering happens locally in a sandboxed engine.</p>
        </div>
        <div class="template-grid">
          <div class="template-editor">
            <div class="preset-row">
              <label for="presetFormats">Presets</label>
              <select id="presetFormats"></select>
              <button id="applyPreset" type="button">Load</button>
              <button id="resetTemplate" type="button">Reset</button>
            </div>
            <p class="preset-description" data-preset-description></p>

            <label for="markdownFormat">Active template</label>
            <textarea
              id="markdownFormat"
              rows="14"
              spellcheck="false"
              autocapitalize="off"
              autocomplete="off"
              autocorrect="off"
            ></textarea>

            <div class="preset-save">
              <label for="presetName">Save current as preset</label>
              <div class="inline-controls">
                <input
                  type="text"
                  id="presetName"
                  placeholder="Preset name"
                  autocomplete="off"
                  aria-describedby="presetNameHint"
                />
                <button id="savePreset" type="button">Save Preset</button>
                <button id="deletePreset" type="button" disabled>Delete</button>
              </div>
              <p id="presetNameHint" class="hint">
                Presets are stored in your browser sync storage and can be exported for sharing.
              </p>
            </div>

            <div class="preset-library">
              <span class="toolbar-label">Preset library</span>
              <button id="importPresets" type="button">Import</button>
              <button id="exportPresets" type="button">Export</button>
              <input type="file" id="presetImportInput" accept="application/json" hidden />
            </div>

            <div class="template-feedback" data-template-feedback aria-live="polite"></div>
          </div>

          <div class="template-preview">
            <div class="preview-header">
              <h3>Live Preview</h3>
              <span>Rendered with sample tabs</span>
            </div>
            <pre class="preview-output" data-template-preview></pre>
          </div>
        </div>

        <div class="variable-docs" data-template-docs>
          <h3>Template variables</h3>
          <p>Reference these placeholders inside your template body. Each export runs with the context below.</p>
          <ul>
            <li><code>{{{frontmatter}}}</code> &mdash; pre-built YAML block that includes export date, time, tab count, and window metadata. Field names follow your configuration above.</li>
            <li><code>{{export.iso}}</code>, <code>{{export.local.date}}</code>, <code>{{export.local.time}}</code>, <code>{{export.filename}}</code>, <code>{{export.tabCount}}</code></li>
            <li><code>{{frontmatterFields.date}}</code>, <code>{{frontmatterFields.windowTitle}}</code>, etc. &mdash; resolved frontmatter key names.</li>
            <li><code>{{window.title}}</code>, <code>{{window.id}}</code>, <code>{{window.focused}}</code>, <code>{{window.incognito}}</code></li>
            <li>Inside <code>{{#tabs}}</code>: <code>{{title}}</code>, <code>{{url}}</code>, <code>{{origin}}</code>, <code>{{hostname}}</code>, <code>{{protocol}}</code>, <code>{{pathname}}</code>, <code>{{search}}</code>, <code>{{hash}}</code>, <code>{{favicon}}</code></li>
            <li>Tab helpers: <code>{{index}}</code>, <code>{{position}}</code>, <code>{{active}}</code>, <code>{{highlighted}}</code>, <code>{{pinned}}</code>, <code>{{audible}}</code>, <code>{{muted}}</code>, <code>{{discarded}}</code>, <code>{{incognito}}</code></li>
            <li>Timestamps: <code>{{timestamps.lastAccessed}}</code>, <code>{{timestamps.lastAccessedRelative}}</code></li>
          </ul>
          <p class="hint">
            Use sections (<code>{{#favicon}}...{{/favicon}}</code>) and inverted sections (<code>{{^timestamps.lastAccessed}}</code>) for optional values. Triple mustaches (e.g. <code>{{{frontmatter}}}</code>) bypass HTML escaping.
          </p>
        </div>
      </section>

      <section class="panel panel-restricted">
        <div class="panel-header">
          <h2>Restricted URLs</h2>
          <p>Pages containing these substrings are skipped during exports. Place one entry per line.</p>
        </div>
        <textarea id="restrictedUrls" rows="12" spellcheck="false"></textarea>
        <div class="restricted-toolbar">
          <button id="restrictedImport" type="button">Import list</button>
          <button id="restrictedExport" type="button">Export list</button>
          <input type="file" id="restrictedImportInput" accept="text/plain,application/json" hidden />
        </div>
      </section>

      <footer class="credits">
        <p>
          <a href="https://www.flaticon.com/free-icons/tabs" title="tabs icons"
            >Tabs icons created by Freepik - Flaticon</a
          >
        </p>
        <p>
          Created by
          <a href="https://x.com/cgranier">Carlos Granier</a> in Miami, FL.
        </p>
      </footer>
    </div>
  </body>
</html>
